!function(t){t.fn.extend({autocomplete:function(e,a){var n="string"==typeof e;return(a=t.extend({},t.Autocompleter.defaults,{url:n?e:null,data:n?null:e,delay:n?t.Autocompleter.defaults.delay:10,max:a&&!a.scroll?10:150},a)).highlight=a.highlight||function(t){return t},a.formatMatch=a.formatMatch||a.formatItem,this.each(function(){new t.Autocompleter(this,a)})},result:function(t){return this.bind("result",t)},search:function(t){return this.trigger("search",[t])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(t){return this.trigger("setOptions",[t])},unautocomplete:function(){return this.trigger("unautocomplete")}}),t.Autocompleter=function(e,a){var n,r,l,s={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},o=t(e).attr("autocomplete","off").addClass(a.inputClass),c="",u=t.Autocompleter.Cache(a),d=0,f={mouseDownOnSelect:!1},h=t.Autocompleter.Select(a,e,p,f),v="";function p(){var n=h.selected();if(!n)return!1;var r=n.result;if(c=r,a.multiple){var l=g(o.val());if(l.length>1){var s,u=a.multipleSeparator.length,d=t(e).selection().start,f=0;t.each(l,function(t,e){if(d<=(f+=e.length))return s=t,!1;f+=u}),l[s]=r,r=l.join(a.multipleSeparator)}r+=a.multipleSeparator}if("1"==o.attr("iscontact")){var v=r.split("#"),p=v[0],m=v[1],$="",_=o.attr("targetdiv"),b=o.attr("targethidden");""==p&&(p=m),$="<div class='email-list corner' eid='"+m+"'><div class='left'>"+p+"</div><div class='left del-email'>x</div></div>",t("."+_).append($),o.val("");var w=t("."+b);""==w.val()?w.val(m):w.val(w.val()+","+m)}else r.indexOf("<br/>")>0&&(r=r.substring(0,r.indexOf("<br/>"))),o.val(r);return C(),function e(n){var r=(n+"").split(",");val=r[r.length-1],void 0!=a.hdnval&&a.hdnval.val(val),o.attr("v",val);var l=r[0];if(void 0!=_txtselected_ac&&null!=_txtselected_ac&&void 0!=_txtselected_ac)_txtselected_ac.val(l),_txtselected_ac.parent().find(".hdnac").val(val),hideTopAc_mob();else if(void 0!=o.attr("target"))t("#"+o.attr("target")).val(l),t("#"+o.attr("target")).parent().find(".hdnac").val(val),hideTopAc_mob();else if(o.hasClass("multiselectac")){var s=o.closest("td");0==s.find(".multicheckbox-selected-text").length&&s.append('<div class="multicheckbox-selected-text" style="max-width:300px;padding-top:5px;"></div>');var c=s.find(".multicheckbox-selected-text"),u='<div class="mchkjs-selected-val mchkjs-selected-val-'+val+'" value="'+val+'"><div class="mchkjs-text">'+o.val()+'</div><div class="mchkjs-close" style="display: block;">x</div></div>';c.find(".mchkjs-selected-val-"+val).remove(),c.append(u);var d="";c.find(".mchkjs-selected-val").each(function(){""==d?d=t(this).attr("value"):d+=","+t(this).attr("value")}),s.find(".hdnac").val(d),o.val("")}}(n.data),o.trigger("result",[n.data,n.value]),!0}function m(t,e){if(b())return!1;if(void 0!=a.hdnval&&a.hdnval.val(""),r==s.DEL){h.hide();return}var n=o.val();(e||n!=c)&&(c=n,(n=$(n)).length>=a.minChars?(o.addClass(a.loadingClass),a.matchCase||(n=n.toLowerCase()),w(n,_,C)):(x(),h.hide()))}function g(e){return e?a.multiple?t.map(e.split(a.multipleSeparator),function(a){return t.trim(e).length?t.trim(a):null}):[t.trim(e)]:[""]}function $(n){if(!a.multiple)return n;var r=g(n);if(1==r.length)return r[0];var l=t(e).selection().start;return(r=l==n.length?g(n):g(n.replace(n.substring(l),"")))[r.length-1]}function C(){h.visible(),h.hide(),clearTimeout(n),x(),a.mustMatch&&o.search(function(t){if(!t){if(a.multiple){var e=g(o.val()).slice(0,-1);o.val(e.join(a.multipleSeparator)+(e.length?a.multipleSeparator:""))}else o.val(""),o.trigger("result",null)}})}function _(n,l){if(l&&l.length&&d){var u,f;x(),h.display(l,n),u=n,f=l[0].value,a.autoFill&&$(o.val()).toLowerCase()==u.toLowerCase()&&r!=s.BACKSPACE&&(o.val(o.val()+f.substring($(c).length)),t(e).selection(c.length,c.length+f.length)),h.show()}else C()}function b(){return!!o.hasClass("disabled")||void 0!=o.attr("disabled")||void 0!=o.attr("readonly")}function w(n,r,l){if(b())return!1;if(o.val().length<2&&o.removeAttr("nodata"),o.hasClass("txtautofill")&&"true"==o.attr("nodata"))return x(),!1;a.matchCase||(n=n.toLowerCase());var s=function e(){var a=o.attr("acparent"),n="",r="",l="";if(void 0!=a)for(i=0,n=a.split(",");i<n.length;i++){var s=GetDataControl(n[i]);if(void 0!=s){var c="";if(void 0!=s.attr("dcn")){var u=s.attr("dcn").split("_");c=u[u.length-1]}else c=s.attr("id");var d=s.val();d.indexOf("-")&&(d=d.split("-")[0]),""==l?(l=c,r=d):(l=l+","+c,r=r+","+d)}}var f="&ec="+l+"&ev="+r;return void 0!=o.attr("ec")&&(f="&ec="+o.attr("ec")+"&ev="+o.attr("ev")),t(".clientid").length>0&&(f+="&clientid="+t(".clientid").val()),f}(),c=a.url+s;u.flush(),v=c;var d=u.load(n);if(d&&d.length)r(n,d);else if("string"==typeof a.url&&a.url.length>0){var f={timestamp:+new Date};t.each(a.extraParams,function(t,e){f[t]="function"==typeof e?e():e}),_isMobile&&(c+="&ismobile=true"),t.ajax({mode:"abort",port:"autocomplete"+e.name,dataType:a.dataType,url:c,cache:!1,data:t.extend({q:$(n),limit:a.max},f),success:function(e){""==e&&o.attr("nodata","true");var l=a.parse&&a.parse(e)||function e(n){for(var r=[],l=n.split("\n"),s=0;s<l.length;s++){var o=t.trim(l[s]);o&&(o=o.split("|"),r[r.length]={data:o,value:o[0],result:a.formatResult&&a.formatResult(o,o[0])||o[0]})}return r}(e);u.add(n,l),r(n,l)}})}else h.emptyList(),l(n)}function x(){o.removeClass(a.loadingClass)}t.browser.opera&&t(e.form).bind("submit.autocomplete",function(){if(l)return l=!1,!1}),o.click(function(){if(b())return!1;""==t(this).val()&&w("%",_,C)}),o.bind((t.browser.opera?"keypress":"keydown")+".autocomplete",function(e){switch(d=1,r=e.keyCode,e.keyCode){case s.UP:e.preventDefault(),h.visible()?h.prev():m(0,!0);break;case s.DOWN:e.preventDefault(),h.visible()?h.next():m(0,!0);break;case s.PAGEUP:e.preventDefault(),h.visible()?h.pageUp():m(0,!0);break;case s.PAGEDOWN:e.preventDefault(),h.visible()?h.pageDown():m(0,!0);break;case a.multiple&&","==t.trim(a.multipleSeparator)&&s.COMMA:case s.TAB:if(p())return!0;break;case s.RETURN:if(p())return e.preventDefault(),l=!0,!1;break;case s.ESC:h.hide();break;default:clearTimeout(n),n=setTimeout(m,a.delay)}}).focus(function(){if(b())return!1;d++}).blur(function(){d=0,f.mouseDownOnSelect||(clearTimeout(n),n=setTimeout(C,200))}).click(function(){d++>1&&!h.visible()&&m(0,!0)}).bind("search",function(){var e=arguments.length>1?arguments[1]:null;function a(t,a){var n;if(a&&a.length){for(var r=0;r<a.length;r++)if(a[r].result.toLowerCase()==t.toLowerCase()){n=a[r];break}}"function"==typeof e?e(n):o.trigger("result",n&&[n.data,n.value])}t.each(g(o.val()),function(t,e){w(e,a,a)})}).bind("flushCache",function(){u.flush()}).bind("setOptions",function(){t.extend(a,arguments[1]),"data"in arguments[1]&&u.populate()}).bind("unautocomplete",function(){h.unbind(),o.unbind(),t(e.form).unbind(".autocomplete")})},t.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:50,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(t){return t[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(t,e){return t.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:300},t.Autocompleter.Cache=function(e){var a={},n=0;function r(t,a){e.matchCase||(t=t.toLowerCase());var n=t.indexOf(a);return"word"==e.matchContains&&(n=t.toLowerCase().search("\\b"+a.toLowerCase())),-1!=n&&(0==n||e.matchContains)}function l(t,r){n>e.cacheLength&&o(),!a[t]&&n++,a[t]=r}function s(){if(!e.data)return!1;var a={},n=0;e.url||(e.cacheLength=1),a[""]=[];for(var r=0,s=e.data.length;r<s;r++){var o=e.data[r];o="string"==typeof o?[o]:o;var c=e.formatMatch(o,r+1,e.data.length);if(!1!==c){var u=c.charAt(0).toLowerCase();a[u]||(a[u]=[]);var d={value:c,data:o,result:e.formatResult&&e.formatResult(o)||c};a[u].push(d),n++<e.max&&a[""].push(d)}}t.each(a,function(t,a){e.cacheLength++,l(t,a)})}function o(){a={},n=0}return setTimeout(s,25),{flush:o,add:l,populate:s,load:function(l){if(!e.cacheLength||!n)return null;if(!e.url&&e.matchContains){var s=[];for(var o in a)if(o.length>0){var c=a[o];t.each(c,function(t,e){r(e.value,l)&&s.push(e)})}return s}if(a[l])return a[l];if(e.matchSubset)for(var u=l.length-1;u>=e.minChars;u--){var c=a[l.substr(0,u)];if(c){var s=[];return t.each(c,function(t,e){r(e.value,l)&&(s[s.length]=e)}),s}}return null}}},t.Autocompleter.Select=function(e,a,n,r){var l,s,o,c,u={ACTIVE:"ac_over"},d=-1,f="",h=!0;function v(t){for(var e=t.target;e&&"LI"!=e.tagName;)e=e.parentNode;return e||[]}function p(t){l.slice(d,d+1).removeClass(u.ACTIVE),(d+=a=t)<0?d=l.size()-1:d>=l.size()&&(d=0);var a,n=l.slice(d,d+1).addClass(u.ACTIVE);if(e.scroll){var r=0;l.slice(0,d).each(function(){r+=this.offsetHeight}),r+n[0].offsetHeight-c.scrollTop()>c[0].clientHeight?c.scrollTop(r+n[0].offsetHeight-c.innerHeight()):r<c.scrollTop()&&c.scrollTop(r)}}return{display:function(p,m){(function l(){if(h){var s=t(a).attr("id"),f=s.split("_");s=f[f.length-1],o=t("<div/>").hide().addClass(e.resultsClass).addClass(e.resultsClass+"_"+s).css("position","absolute").appendTo(document.body),c=t("<ul/>").appendTo(o).mouseover(function(e){v(e).nodeName&&"LI"==v(e).nodeName.toUpperCase()&&(d=t("li",c).removeClass(u.ACTIVE).index(v(e)),t(v(e)).addClass(u.ACTIVE))}).click(function(r){if(t(v(r)),!e.issearch)return t(v(r)).addClass(u.ACTIVE),n(),a.focus(),!1;n()}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),_isMobile&&(e.width=t(window).width()-50),e.width>0&&o.css("width",e.width),h=!1}})(),s=p,f=m,function n(){c.empty();for(var r=(m=s.length,e.max&&e.max<m?e.max:m),o=0;o<r;o++)if(s[o]){var h=e.formatItem(s[o].data,o+1,r,s[o].value,f);if(!1!==h){var v=t(a).attr("iscontact"),p="";if(e.issearch){e.highlight(h,f);var m,g=s[o].data+"",$=g.split(","),C=$[1],_=(g=$[0]).split("#");p=_.length>1?"<div class='search-item-category' cid='"+C+"'>"+_[0]+"</div>":"<div class='search-item-product' pid='"+C+"'>"+e.highlight(h,f)+"</div>"}else if(void 0==v)p=e.highlight(h,f);else{e.highlight(h,f);var g=s[o].data+"",$=g.split(","),C=$[1],_=(g=$[0]).split("#"),b=_[3];b="default"==b?"default.png":_[3]+".jpg";var w="";w=""==_[0].trim()?_[2]:_[0]+"<"+_[0]+">",p="<div class='autopop'>",p+="<div class='left'><img src='../images/user/thumb/"+b+"'></div>",p+="<div class='left'>",p+="<div><b>"+_[0]+"</b></div>",p+="<div>"+_[1]+"</div>",p+="<div>"+_[2]+"</div>",p+="</div>",p+="</div>"}var x=t("<li/>").html(p).addClass(o%2==0?"ac_even":"ac_odd").appendTo(c)[0];t.data(x,"ac_data",s[o])}}l=c.find("li"),e.selectFirst&&(l.slice(0,1).addClass(u.ACTIVE),d=0),t.fn.bgiframe&&c.bgiframe()}()},next:function(){p(1)},prev:function(){p(-1)},pageUp:function(){0!=d&&d-8<0?p(-d):p(-8)},pageDown:function(){d!=l.size()-1&&d+8>l.size()?p(l.size()-1-d):p(8)},hide:function(){o&&o.hide(),l&&l.removeClass(u.ACTIVE),d=-1},visible:function(){return o&&o.is(":visible")},current:function(){return this.visible()&&(l.filter("."+u.ACTIVE)[0]||e.selectFirst&&l[0])},show:function(){var n=t(a).offset();if(o.css({width:"string"==typeof e.width||e.width>0?e.width:t(a).width(),top:n.top+a.offsetHeight,left:n.left}).show(),e.scroll&&(c.scrollTop(0),t.browser.msie&&void 0===document.body.style.maxHeight)){var r=0;l.each(function(){r+=this.offsetHeight});var s=r>e.scrollHeight;c.css("height",s?e.scrollHeight:r),s||l.width(c.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right")))}},selected:function(){var e=l&&l.filter("."+u.ACTIVE).removeClass(u.ACTIVE);return e&&e.length&&t.data(e[0],"ac_data")},emptyList:function(){c&&c.empty()},unbind:function(){o&&o.remove()}}},t.fn.selection=function(t,e){if(void 0!==t)return this.each(function(){if(this.createTextRange){var a=this.createTextRange();void 0===e||t==e?(a.move("character",t),a.select()):(a.collapse(!0),a.moveStart("character",t),a.moveEnd("character",e),a.select())}else this.setSelectionRange?this.setSelectionRange(t,e):this.selectionStart&&(this.selectionStart=t,this.selectionEnd=e)});var a=this[0];if(a.createTextRange){var n=document.selection.createRange(),r=a.value,l=n.text.length;n.text="<->";var s=a.value.indexOf("<->");return a.value=r,this.selection(s,s+l),{start:s,end:s+l}}if(void 0!==a.selectionStart)return{start:a.selectionStart,end:a.selectionEnd}}}(jQuery);